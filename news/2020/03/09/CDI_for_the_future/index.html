<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="CDI future"><title>CDI for the future | Contexts and Dependency Injection</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/stylesheets/asciidoctor.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css"><link rel="stylesheet" href="/stylesheets/styles.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script><!--[if lt IE 9]><script type="text/javascript" src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><script>hljs.initHighlightingOnLoad(); </script></head><body><div class="container"><div class="row"><div class="col-md-12"><div class="bannerhome"><div class="container"><div class="row"><div class="col-md-3"><a href="http://www.cdi-spec.org"><img src="/images/cdi_herologo.png" style="max-height: 100px;"></a></div><div class="col-md-9"><h1>Contexts & Dependency Injection for Java</h1></div></div></div></div><nav class="navbar navbar-default navbar-static-top" role="navigation"><div class="container-fluid"><div class="navbar-header"><button class="navbar-toggle collasped" type="button" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="http://www.cdi-spec.org"><i class="fa fa-home fa-fw"></i></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href="http://www.cdi-spec.org/download/"><i class="fa fa-download fa-fw"></i> Download </a></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-university fa-fw"></i> Learn <b class="caret"></b><ul class="dropdown-menu" role="menu"><li><a href="http://www.cdi-spec.org/learn/"><i class="fa fa-graduation-cap fa-fw"></i> Learning resources </a></li><li><a href="http://www.cdi-spec.org/faq/"><i class="fa fa-question-circle fa-fw"></i> FAQ </a></li></ul></a></li><li><a href="http://www.cdi-spec.org/ecosystem/"><i class="fa fa-plug fa-fw"></i> Ecosystem </a></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-expanded="false">Contribute <b class="caret"></b><ul class="dropdown-menu" role="menu"><li><a href="http://www.cdi-spec.org/contribute/"><i class="fa fa-edit fa-fw"></i> How to contribute </a></li><li><a href="https://github.com/eclipse-ee4j/cdi/issues" target="_BLANK"><i class="fa fa-tasks fa-fw"></i> Bug tracker </a></li></ul></a></li><li><a href="http://www.cdi-spec.org/cditck/"><i class="fa fa-tag fa-fw"></i> CDI TCK </a></li><li><a href="http://www.cdi-spec.org/news/"><i class="fa fa-bullhorn fa-fw"></i> Blog </a></li><li><a href="http://www.cdi-spec.org/mailinglist/"><i class="fa fa-envelope fa-fw"></i> Mailing List </a></li></ul></div></div></nav><script>var indexOfSharp = window.location.pathname.indexOf('#');
var pathname = indexOfSharp > 0 ? window.location.pathname.substring(0, indexOfSharp) : window.location.pathname;
var selector = "body > .container > .row > .col-md-12 > .navbar > .container-fluid > .navbar-collapse a[href='http://www.cdi-spec.org" + pathname + "']";
$(selector).closest("li").addClass("active");</script></div></div><div class="row content-wrapper"><div class="col-md-12"><div class="row"><div class="col-md-12"><article class="post"><div class="panel panel-primary"><div class="panel-body"><ul class="pager visible-md-block visible-lg-block"><li class="previous"><a href="/news/2017/05/15/CDI_2_is_released/">Previous: CDI 2.0 is released </a></li><li class="next"><a href="/news/2020/09/15/CDI_Lite_extension/">Next: Build Compatible Extensions Proposal </a></li></ul><ul class="pager visible-sm-block visible-xs-block"><li class="previous"><a href="/news/2017/05/15/CDI_2_is_released/"> Previous</a></li><li class="next"><a href="/news/2020/09/15/CDI_Lite_extension/"> Next</a></li></ul><h1><a href="/news/2020/03/09/CDI_for_the_future/">CDI for the future</a></h1><div class="meta"><strong>Posted by  <span class="authors">Antoine Sabot-Durand</span> on  <span class="date">Mar 09, 2020</span> |   <a href="http://www.cdi-spec.org/news/2020/03/09/CDI_for_the_future/#disqus_thread">Comments</a> </strong></div><div class="content"><div class="imageblock" style="float: right">
<div class="content">
<img src="/images/inside_quark_web.jpg" alt="inside quark web" width="285">
</div>
</div>
<div class="paragraph">
<p>A few months  ago, CDI turned 10! Yes, CDI 1.0 was released 10 years ago and is today one of the most successful specifications in Java EE and now Jakarta EE. Providing a very efficient programming model and elegant means to integrate with 3rd party technology it rapidly became the Java EE cornerstone. As other specifications were adopting its programming model, CDI brought a unified way to write Java EE code and made the platform more consistent than before. So when MicroProfile was launched nearly four years ago, it was obvious that CDI should be part of the core platform along with JAX-RS and JSON-P. Today, MicroProfile programming model relies deeply on CDI and the platform success is partly due to the consistency CDI brings to developer experience.</p>
</div>
<div class="paragraph">
<p>Yet, CDI was designed more than 10 years ago at a time when monolithic applications were deployed as ears and wars sharing a highly dynamic yet monolithic application server. Things have changed, where containers are immutable, obviating the need for hot redeploy and dynamic discovery, and aspects that we used to rely on traditional application servers for, such as availability and redundancy are now handled using cloud orchestration with kubernetes. We also have seen a shift from monolithic apps to a greater emphasis on decoupling and resilience through microservices.  These factors have given rise to the “single app stack”, where the framework and the application are fused as one.  With traditional application servers,  applications had to be dynamic <strong>because</strong> they needed to differentiate their needs on shared application server infrastructure, where configuration and resources applied equally to all applications. With single application stacks, applications can express their needs more statically because they are scoped to a single application.</p>
</div>
<div class="paragraph">
<p>In addition, today&#8217;s deployments require increasing efficiency to achieve cost reduction, whether deploying to cloud providers or in-house virtualized data centers. A single application server instance  is often replaced by a dozen microservice “single-app stack”  instances, with double or triple that amount to achieve redundancy. CDI, as it is today, is not suited for this cloud ready approach. Some of its features imply a rather heavy resource consumption (both boot-time and memory usage) in its implementations.<br>
This blog post covers some of my CDI vision for the future to make the specification relevant for the next 10 years.</p>
</div>
<div class="sect1">
<h2 id="how-to-make-cdi-cloud-ready"><a class="anchor" href="#how-to-make-cdi-cloud-ready"></a>How to make CDI cloud ready?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If we want to make CDI a cloud ready specification we have to look into all of its requirements that impact memory, cpu, and more broadly performance. As part of that we should revisit which capabilities and features are still required, since as mentioned above application architecture and deployment environments have changed significantly over the years. Although, that alone is not enough, we need to ensure CDI is flexible and adaptable enough to allow for innovative implementation approaches, such as build-time injection wiring.</p>
</div>
<div class="paragraph">
<p>Of course, It should be possible to implement runtime-based approaches in a more efficient manner, and in many ways these goals are complimentary.  One example of this is overly aggressive bean discovery and thus the extensive type scanning required by CDI during initialization.  While bean discovery allows seamless integration in that 3rd party non-CDI classes can be discovered as bean, storing state and generating events on classes which were never intended to be a bean is very costly. That’s the reason why, when we introduced CDI for Java SE in CDI 2.0, we provided a way to disable <a href="https://docs.jboss.org/cdi/spec/2.0/cdi-spec.html#se_container_initializer">bean discovery</a> and let the developers explicitly declare classes that should become beans or allow the creation of synthetic beans before launching the container.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eclipse-microprofile-challenges"><a class="anchor" href="#eclipse-microprofile-challenges"></a>Eclipse MicroProfile Challenges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CDI spec was originally written with Jakarta EE integration in mind, and as such, it assumes the full platform is available and thus the spec and the TCKs require JSF, EL, and EJB. This is not the best fit for MicroProfile, since it targets microservice usage patterns. Under MicroProfile not even Servlet is required, let alone EJB, EL, and JSF. Likewise, MicroProfile can’t be based on CDI SE, since SE does not include JAX-RS integration, which is essential for REST based microservices.</p>
</div>
<div class="paragraph">
<p>To solve this problem, the MicroProfile specifications effectively depend on a subset of the CDI spec, explicitly noting the above API elements are to be excluded. This is awkward and has led to confusion about how one achieves compliance.</p>
</div>
<div class="paragraph">
<p>Ultimately, the problem is that the CDI spec couples too many elements together. We need greater flexibility to allow for as many different platforms and environments to adopt and build off the standard.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introducing-cdi-lite"><a class="anchor" href="#introducing-cdi-lite"></a>Introducing CDI Lite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you followed the CDI 2.0 expert group work a few years back, this title should ring a bell. CDI Lite was in the air back then, since we did expect some future need of added flexibility, but due to a lack of time and clear target we postponed its addition to the spec.</p>
</div>
<div class="paragraph">
<p>With the CDI programming model being core to MicroProfile, it seems obvious that its use cases should be considered as a first-class usage of CDI. Further, we should enable CDI composition into any other  platform, such as future Jakarta EE profiles, or combining it with other frameworks on top of plain old Java as a contribution to future innovations within the Java ecosystem.</p>
</div>
<div class="paragraph">
<p>So what should CDI Lite’s goal be? In my opinion we should define it as: “the core subset of CDI features that enables the greatest number of CDI implementations, CDI usage within the Java ecosystem, and opens the door to innovation, notably build-time injection approaches.”</p>
</div>
<div class="paragraph">
<p>Not only would this improve the existing CDI ecosystem, it opens the door to many other interesting use cases such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Transcompilation.</strong> It becomes possible to compile Java based injection into other language environments, such as Javascript. This is currently possible with Dagger and Kodein for Kotlin but not CDI</p>
</li>
<li>
<p><strong>Mobile platform support.</strong> By enabling build time injection, it also becomes possible for an implementer to target mobile platforms such as Android.</p>
</li>
<li>
<p><strong>Native Compilation.</strong> By enabling build-time Java, the door is also opened to generating optimal native compiled images utilizing static compilers such as the GraalVM project.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="how-to-add-cdi-lite-to-the-spec"><a class="anchor" href="#how-to-add-cdi-lite-to-the-spec"></a>How to add CDI lite to the spec?</h3>
<div class="paragraph">
<p>Today, thanks to CDI 2.0 work, the spec is split into 3 parts: core, CDI for SE and CDI for EE.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/cdi2-layers.png" alt="cdi2 layers">
</div>
<div class="title">Figure 1. Current CDI spec layering</div>
</div>
<div class="paragraph">
<p>Users and implementers are already familiar with the notion of different “flavors” for CDI.  Adding CDI Lite implies some work but the spec is already well organized to support such a change. Roughly, CDI lite should be defined as the core subset of which core, EE and SE extend. Further the EE spec integrations themselves can be defined in such a way so that each framework’s integration is optional, allowing any combination such as a standalone JAX-RS implementation with CDI support. Additionally this would enable future additional Jakarta EE profiles beyond just web and full.<br>
This evolution would split Core CDI in CDI Lite and “Heavy CDI” as shown below. The CDI lite part could benefit CDI for Se as other platforms like MicroProfile.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/cdi3-layers.png" alt="cdi3 layers">
</div>
<div class="title">Figure 2. Spliting CDI Core in <em>lite</em> and <em>full</em></div>
</div>
</div>
<div class="sect2">
<h3 id="cdi-lite-scope"><a class="anchor" href="#cdi-lite-scope"></a>CDI Lite Scope</h3>
<div class="paragraph">
<p>The essential fundamental core of CDI is the programming model exposed to users which enables uniform annotation driven injection and further supports contextual state driven injection. Just the annotations defined in JSR-330 are not enough, there is also the need for a number of other common patterns and usages to make the framework complete.</p>
</div>
<div class="paragraph">
<p>Support popular CDI features like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beans (class, producers and synthetic beans)</p>
</li>
<li>
<p>CDI DI (typesafe resolution, qualifiers, dynamic lookup)</p>
</li>
<li>
<p>Most built-in scopes (singleton, application, request, and dependent)</p>
</li>
<li>
<p>Contextual instances and their lifecycle</p>
</li>
<li>
<p>Interceptors</p>
</li>
<li>
<p>Events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other features may be added but may not have reached broad adoption like decorators, transactional events or specialization, so additional discussion would be needed.. Ideally we would utilize the opportunity to reduce technical debt, since each increases code complexity, and some of these underused capabilities are a major source of bug reports:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Decorators have 67 issues in the RI alone</p>
</li>
<li>
<p>Specialization has 28 RI issues and 6 open spec issues</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="outside-cdi-lite-scope"><a class="anchor" href="#outside-cdi-lite-scope"></a>Outside CDI Lite Scope</h3>
<div class="paragraph">
<p>A number of features are only relevant to particular framework integrations. For example SessionScope is only relevant if the runtime environment implements Servlet (HttpSession), and ConversationScope is incomplete without EL and JSF. These technologies are not needed in a microservice scenario, as is the case in MicroProfile, and so should not be required.</p>
</div>
<div class="paragraph">
<p>Another capability that should be excluded from CDI Lite is portable extensions, but still part of CDI Full. Portable extensions run in opposition to the goals described above, since they are inherently a runtime-only contract which mandates a very specific container initialization lifecycle. As an example, portable extensions are often stateful, but they are not serializable, and any state they have can be passed into other beans or as part of lifecycle events that are required to occur. Further they are allowed to manipulate almost anything pertaining to a bean at just about every phase of the CDI lifecycle. These factors effectively preclude any implementation that aims to pregenerate wiring at build time. Yet extension implementations rarely need such an open-ended do-anything-you-want API.</p>
</div>
<div class="paragraph">
<p>Instead,  the CDI-Lite could address these concerns through purpose-built SPIs, such as  introducing a new explicit way to register annotated types and beans. It’s already partly done in CDI for SE in which users can programmatically add synthetic beans without portable extensions.</p>
</div>
<div class="paragraph">
<p>All of the elements outside of the CDI-Lite scope would still be a part of the full specification, as the intention is not to affect existing implementations, only to open the door to new approaches and new implementations.</p>
</div>
<div class="paragraph">
<p>In the end, we would end up with a much more flexible standard that benefits everyone and carries over the same powerful programming model to new use-cases while bringing  improved efficiency to modern cloud deployment scenarios. <br>
CDI Llite introduction wouldn’t be the pretext to deprecate existing features but to make the framework more modular and ready for all todays use cases and make it ready for future evolution.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you may guess this spec evolution idea will require a lot of analysis and discussion. Should the Jakarta Contexts and Dependency Injection Project agree to go this way, we could imagine starting work on this new CDI version, but as usual, feedback from the community is very important to us. So feel free to share your thoughts in the comments of this post.</p>
</div>
<div class="paragraph">
<p>Thanks for helping us keep the CDI programming model around for the next 10 years!</p>
</div>
</div>
</div></div><div class="footer"><a href="/news/2020/03/09/CDI_for_the_future/"> Permalink</a> <a href="http://www.cdi-spec.org/news/2020/03/09/CDI_for_the_future/#disqus_thread">Comments</a> <span class="tags"><i class="icon-tags"></i>Tags :<a class="tag" href="/news/tags/Proposal/">Proposal</a></span></div><ul class="pager visible-md-block visible-lg-block"><li class="previous"><a href="/news/2017/05/15/CDI_2_is_released/">Previous: CDI 2.0 is released </a></li><li class="next"><a href="/news/2020/09/15/CDI_Lite_extension/">Next: Build Compatible Extensions Proposal </a></li></ul><ul class="pager visible-sm-block visible-xs-block"><li class="previous"><a href="/news/2017/05/15/CDI_2_is_released/"> Previous</a></li><li class="next"><a href="/news/2020/09/15/CDI_Lite_extension/"> Next</a></li></ul>
            <script type="text/javascript">
            var disqus_shortname = 'cdispec';
            (function () {
              var s = document.createElement('script'); s.async = true;
              s.src = '//' + disqus_shortname + '.disqus.com/count.js';
              (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
            }());
            </script>
          <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
            var disqus_shortname = 'cdispec';
            var disqus_url = "http://www.cdi-spec.org/news/2020/03/09/CDI_for_the_future/";
            var disqus_developer = null;
            var disqus_identifier = null;
            (function() {
              var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=cdispec">comments powered by Disqus.</a></noscript>
          </div></div></div></article></div></div></div></div></div><hr><footer></footer><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount','UA-37580744-1']);
_gaq.push(['_trackPageview']);
(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</body></html>